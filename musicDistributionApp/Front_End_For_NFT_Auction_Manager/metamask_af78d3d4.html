<!DOCTYPE html>
<!-- saved from url=(0103)https://andromeda.cs.virginia.edu/explorer/auctions.php?addr=0xdbeb0000014661c033350fb04ee88d4b55ca7a4a -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Auctions Contract Interaction</title>
	    
	    <script src="https://cdn.jsdelivr.net/npm/web3@1.x/dist/web3.min.js"></script>
    <style>body{font:15px/1.4 Helvetica,arial,freesans,clean,sans-serif}h1{font-size:2.5em;border-bottom:1px solid rgb(221, 221, 221)}h2{font-size:2em;border-bottom:1px solid rgb(238, 238, 238)}code{background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);font-size:13px;padding:0 5px;border-radius:3px}pre{background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);padding:6px 10px;overflow:auto}pre code{border:none;padding:0}img{max-width:100%}blockquote{background:#f9f9f9;border-left:5px solid #cccccc;margin:1em 10px;padding:0.25em 10px}table{border-collapse:collapse;border-spacing:0;word-break:keep-all}table tr{background-color:#FFF;border-top:1px solid #CCC}table th{padding:6px 13px;border:1px solid #d9dcdf;background-color:#cccccc}table td{padding:6px 13px;border:1px solid #d9dcdf}table tr:nth-child(2n){background-color:#f8f8f8}td.wrap{word-break:break-all}.mono{word-break:break-all;font-size:small;font-family:monospace;white-space:nowrap}.monoreg{word-break:break-all;font-size:smaller;font-family:monospace;white-space:nowrap}body{margin-top:75px}.topnav{overflow:hidden;background-color:#ebecee}.topnav a{float:left;display:block;color:black;text-align:center;padding:10px 16px;text-decoration:none;font-size:17px;border-radius:10px;font-size:revert}div.topnav{margin-top:60px}table.topnav{width:100%;position:fixed;top:0;left:0;right:0;overflow:hidden;height:53px}tr.topnav td h1{border-bottom:0}tr.topnav,tr.topnav td{padding-top:0;padding-bottom:0;border:none;border-bottom:1px solid #d9dcdf}.topnav h1{margin-top:0;margin-bottom:0}.topnav a:hover{background-color:#d9dcdf;color:black}.topnav a.active{padding:0 10px}.topnav a.active2{background-color:#d9dcdf;margin:2px;padding-top:1px;padding-bottom:1px}.topnav a.active3{background-color:#d9dcdf;margin-left:2px;margin-right:2px;padding-top:13px;padding-bottom:13px}h1.title{margin-top:4px;margin-bottom:-4px}.topnav input[type=text]{float:right;padding:6px;border:none;margin-top:8px;margin-right:16px;font-size:17px;border-radius:10px}@media screen and (max-width: 600px){.topnav a,.topnav input[type=text]{float:none;display:block;text-align:left;width:100%;margin:0;padding:14px}.topnav input[type=text]{border:1px solid #ccc}}table.nav{width:100%}table.nav tr{border:none}table.nav td{border:none}form.link input[type="submit"]{background:none;border:none;color:blue;text-decoration:underline;cursor:pointer;padding:0}.copylink{height:13px;width:13px;display:inline-block;margin-right:5px;vertical-align:middle;background-repeat:no-repeat;cursor:pointer}.navarrow{font-size:x-large;vertical-align:middle}table.transparent tr,table.transparent tr td{border:none;background-color:white}table.list{overflow:auto;height:100px}table.list thead th{position:sticky;z-index:1;top:53px}table.center td,table.list td{text-align:center}@keyframes fadeout{from{background-color:#d9dcdf}to{background-color:white}}span.price{padding:7px 7px 2px;background-color:white;border-radius:3px}.fadeout{animation:2s fadeout}img.cclogo{max-width:32px;max-height:32px;border:1px solid black;border-radius:18px}table.dlist tr td{background-color:white}.wide{display:inline}.narrow{display:none;word-break:break-all}@media (max-width:1000px){.wide{display:none}.narrow{display:inline}div.topnavm{display:block}div.topnav,table.topnav{display:none}table.list thead th{top:49px}}td.break{word-break:break-all}input.search{margin-bottom:8px;width:200px}table.list,table.single{margin-bottom:20px}.mobile-container{padding-left:0;padding-right:0;margin:auto;background-color:#555;height:0;border-radius:10px;margin-left:10px;margin-right:10px}.topnavm{overflow:hidden;background-color:#333;position:relative;display:none;position:fixed;left:0;top:0;width:100%}.topnavm #myLinks{display:none}.topnavm a{color:white;padding:14px 16px;text-decoration:none;font-size:17px;display:block}.topnavm a.title{font-size:large;color:#333;padding-top:10px;padding-bottom:10px}.topnavm a.icon{background:black;display:block;position:absolute;right:0;top:0;font-size:xx-large;padding-top:3px}.topnavm a:hover{background-color:#d9dcdf;color:black}.activem{background-color:#e9e9e9;color:white}input.searchm{margin-bottom:8px;width:200px;font-size:large;margin-left:16px}div.topnavm{z-index:2}span.header_icon{height:20px;width:20px;display:inline-block;margin-right:5px;vertical-align:middle;background-repeat:no-repeat}span.title_icon{height:1em;width:1em;display:inline-block;margin-right:5px;background-repeat:no-repeat}a.header_link{background-color:#d9dcdf;margin:2px;padding:10px}.invert{filter: invert(100%)}code a{color:black;text-decoration:none}span.mono a{color:black;text-decoration:none}table.center tr td{text-align:center}</style>
    </head>
	<body style="margin-top:0">
		<script>
			if ( window.ethereum === undefined )
				window.alert("Please install MetaMask; this page will not work properly without that extension installed");
		</script>
		<script>
			function connectToMetaMask() {
				ethereum.request({ method: 'eth_requestAccounts' });
			}
		</script>
		<button onClick='connectToMetaMask()'>Enable Ethereum</button>
		<hr>

		<script>
// The ABI that Remix provided; this is basically the interface for how to
// interact with the smart contract. This ONLY will work with the standard
// Auctions smart contract!  Note that this is actually a reduced ABI, and
// only contains the read-only (aka 'view') methods.
auctioneerAbi = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"auctionCloseEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"auctionStartEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"higherBidEvent","type":"event"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"auctionTimeLeft","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"auctions","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"string","name":"","type":"string"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"closeAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"collectFees","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"deployer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"nftmanager","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"numAuctions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"placeBid","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"m","type":"uint256"},{"internalType":"uint256","name":"h","type":"uint256"},{"internalType":"uint256","name":"d","type":"uint256"},{"internalType":"string","name":"data","type":"string"},{"internalType":"uint256","name":"reserve","type":"uint256"},{"internalType":"uint256","name":"nftid","type":"uint256"}],"name":"startAuction","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"uncollectedFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}];

// This is a reduced ABI for the NFT manager -- it only contains the info for
// the `tokenURI` method call, which will get us the filename of the NFT.
nftManagerAbi = [{'inputs': [{'internalType': 'address', 'name': 'to', 'type': 'address'}, {'internalType': 'uint256', 'name': 'tokenId', 'type': 'uint256'}], 'name': 'approve', 'outputs': [], 'stateMutability': 'nonpayable', 'type': 'function'}, {'inputs': [{'internalType': 'address', 'name': '_to', 'type': 'address'}, {'internalType': 'string', 'name': '_uri', 'type': 'string'}], 'name': 'mintWithURI', 'outputs': [{'internalType': 'uint256', 'name': '', 'type': 'uint256'}], 'stateMutability': 'nonpayable', 'type': 'function'}, {'inputs': [{'internalType': 'string', 'name': '_uri', 'type': 'string'}], 'name': 'mintWithURI', 'outputs': [{'internalType': 'uint256', 'name': '', 'type': 'uint256'}], 'stateMutability': 'nonpayable', 'type': 'function'}, {'inputs': [{'internalType': 'uint256', 'name': 'tokenId', 'type': 'uint256'}], 'name': 'tokenURI', 'outputs': [{'internalType': 'string', 'name': '', 'type': 'string'}], 'stateMutability': 'view', 'type': 'function'}];

function abicopylink(abi) {
	document.write("<span class='copylink' onclick=\"navigator.clipboard.writeText('" + JSON.stringify(abi).replace(/"/g, "\\'") + "')\">&#x2398</span>");
}
		</script>

		<p>For the IAuctioneer smart contract at address <a href="https://andromeda.cs.virginia.edu/explorer/index.php?account=0xc8cB53280482Ae9407321324CCA164977A6b6eC1" target="_blank">0xc8cB53280482Ae9407321324CCA164977A6b6eC1</a> <span class="copylink" onclick="navigator.clipboard.writeText(&#39;0xc8cB53280482Ae9407321324CCA164977A6b6eC1&#39;)">⎘</span></p>

		<p>Total number of auctions: <span id="numAuctions">3</span></p>

		<p>NFTManager address: <span id="nftmanager"><a href="https://andromeda.cs.virginia.edu/explorer/index.php?account=0xA8088887A03a9A884377ac5019024a5c416C3e22" target="_blank">0xA8088887A03a9A884377ac5019024a5c416C3e22</a> <span class="copylink" onclick="navigator.clipboard.writeText(&quot;0xA8088887A03a9A884377ac5019024a5c416C3e22&quot;)">⎘</span></span></p>

		<p>The auctions are:</p>

		<table id="auction_list" class="center"><tbody><tr><th>Auction<br>ID</th><th>Number<br>of bids</th><th>Data string</th><th>Reserve or<br>highest bid so far</th><th>Highest<br>bidder</th><th>Initiator</th><th>NFT token ID</th><th>Auction end time</th><th>Active?</th><th>NFT link / image</th></tr><tr id="auction_0"><td>0</td><td>2</td><td>Auction for NFT1: Extinguish</td><td>3 eth</td><td>0xE6c...044&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;0xE6ca80619bC5987b40abe97F04f04Df1E66D4044&quot;)">⎘</span></td><td>0x61B...232&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;0x61Ba6c7e14572D2c96ad5A3355eF1eF107456232&quot;)">⎘</span></td><td>1&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;1&quot;)">⎘</span></td><td>Auction has ended</td><td style="word-wrap:break-word;max-width:100px">false</td><td id="nft_0"><a target="_blank" href="./metamask_af78d3d4_files/hnb2at_extinguish.webp"><img style="max-width:80px;max-height:100px" src="./metamask_af78d3d4_files/hnb2at_extinguish.webp"></a></td></tr><tr id="auction_1"><td>1</td><td>2</td><td>Auction for NFT2: Haunted</td><td>3 eth</td><td>0xE6c...044&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;0xE6ca80619bC5987b40abe97F04f04Df1E66D4044&quot;)">⎘</span></td><td>0x61B...232&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;0x61Ba6c7e14572D2c96ad5A3355eF1eF107456232&quot;)">⎘</span></td><td>2&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;2&quot;)">⎘</span></td><td>Auction has ended</td><td style="word-wrap:break-word;max-width:100px">true</td><td id="nft_1"><a target="_blank" href="./metamask_af78d3d4_files/hnb2at_haunted.png"><img style="max-width:80px;max-height:100px" src="./metamask_af78d3d4_files/hnb2at_haunted.png"></a></td></tr><tr id="auction_2"><td>2</td><td>2</td><td>Grading test created at Mon Apr  8 03:09:18 2024</td><td>2 eth</td><td>0x662...bC6&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;0x662263334110F3865E88095978308dcb5D1EEbC6&quot;)">⎘</span></td><td>0x7cA...E25&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;0x7cA16baEd4cE0fb81C2A374C94dF90c1F41a8E25&quot;)">⎘</span></td><td>4&nbsp;&nbsp;<span class="copylink" onclick="navigator.clipboard.writeText(&quot;4&quot;)">⎘</span></td><td>Auction has ended</td><td style="word-wrap:break-word;max-width:100px">false</td><td id="nft_2"><a target="_blank" href="./metamask_af78d3d4_files/1712545758"><img style="max-width:80px;max-height:100px" src="./metamask_af78d3d4_files/1712545758"></a></td></tr></tbody></table>

		<script>

// We connect to the local web socket port that a geth node instance is
// listening on.  This ONLY works because the web server on andromeda is
// configured to re-route calls to /web3 to the geth HTTP-RPC port.
let web3 = new Web3('wss://andromeda.cs.virginia.edu/geth');
let web3mm = new Web3(window.ethereum);

// This is the contract address specified via the URL
var auctioneerContractAddress = web3.utils.toChecksumAddress('0xc8cB53280482Ae9407321324CCA164977A6b6eC1');

// Create a contract object at the specified address for this code to interact with.
auctionContract = new web3.eth.Contract(auctioneerAbi,auctioneerContractAddress);
auctionContractmm = new web3mm.eth.Contract(auctioneerAbi,auctioneerContractAddress);

var nftManagerontractAddress = web3.utils.toChecksumAddress('0xA8088887A03a9A884377ac5019024a5c416C3e22');
nftContract = new web3.eth.Contract(nftManagerAbi, nftManagerontractAddress);
nftContractmm = new web3mm.eth.Contract(nftManagerAbi, nftManagerontractAddress);

async function sleepms(time_ms) {
  await new Promise(resolve => setTimeout(resolve, time_ms));
}

function showReturnIntegerValue(w3,txnhash,desc) {
  w3.eth.getTransaction(txnhash).then(txn => {
    if ( txn['blockNumber'] == null ) {
      sleepms(1000);
      showReturnIntegerValue(w3,txnhash,desc);
    } else
      w3.eth.call({to:txn['to'],from:txn['from'],data:txn['input'],gas:txn['gas']},txn['blockNumber']-1).then(retval => {
      var num = BigInt(retval).toString();
      console.log(num)
      alert(desc+": "+num);
    });
  });
}

// An async function to get the number of auctions from the smart contract
const getNumAuctions = async() => {
	return await auctionContract.methods.numAuctions().call();
}

// An async function to get the auction info -- number of votes and the auction
// name -- from the smart contract.
const getAuctionInfo = async(i) => {
	return await auctionContract.methods.auctions(i).call();
}

// this function is from https://stackoverflow.com/questions/24170933/convert-unix-timestamp-to-date-time-javascript
function convertTimestamp(timestamp) {
    var d = new Date(timestamp * 1000), // Convert the passed timestamp to milliseconds
        yyyy = d.getFullYear(),
        mm = ('0' + (d.getMonth() + 1)).slice(-2),  // Months are zero based. Add leading 0.
        dd = ('0' + d.getDate()).slice(-2),         // Add leading 0.
        hh = d.getHours(),
        h = hh,
        min = ('0' + d.getMinutes()).slice(-2),     // Add leading 0.
        ampm = 'AM',
        time;

    if (hh > 12) {
        h = hh - 12;
        ampm = 'PM';
    } else if (hh === 12) {
        h = 12;
        ampm = 'PM';
    } else if (hh == 0) {
        h = 12;
    }

    // ie: 2014-03-24, 3:00 PM
    time = yyyy + '-' + mm + '-' + dd + ', ' + h + ':' + min + ' ' + ampm;
    return time;
}

function copy_link(data) {
	if ( data != "" )
		//return "&nbsp;<i class='copylink' onclick='navigator.clipboard.writeText(\"$data\")'> </i>";
		return "&nbsp;<span class='copylink' onclick='navigator.clipboard.writeText(\"" + data + "\")'>&#x2398</span>";
}

function short_hash(hash) {
	hash = "" + hash
	if ( hash == "" )
		return "";
	else if ( hash.length < 10 )
		return hash
	else
		return hash.substr(0,5) + "..." + hash.substr(-3);
}

// An async function to get the number of auctions from the smart contract
const getNFTdata = async(row,id) => {
	d = await nftContract.methods.tokenURI(id).call();
	return [row,d];
}

function numberWithCommas(x) {
    // from https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function getHMSstring(t) {
	if ( t == 0 )
		return "0 seconds";
	var tstr = "";
	var h = Math.floor(t/3600);
	if ( h > 0 )
		tstr += h + " hour";
	if ( h > 1 )
		tstr += "s";
	t = t % 3600;
	var m = Math.floor(t/60);
	if ( m > 0 ) {
		if ( tstr != "" )
			tstr += ", ";
		if ( m > 0 )
			tstr += m + " minute";
		if ( m > 1 )
			tstr += "s";
	}
	t = t % 60;
	s = t;
	if ( s > 0 ) {
		if ( tstr != "" )
			tstr += ", ";
		if ( s > 0 )
			tstr += s + " second";
		if ( s > 1 )
			tstr += "s";
	}
	return tstr;
}

// when passed the array of data values, it will update the table row; this
// does NOT get the data from the auction contract (that's already obtained
// in the 'a' parameter), but it DOES get the data from the NFT manager
// contract
//
// Auction struct fields (in order): 0:id, 1:num_bids, 2:data, 3:highestBid, 4:winner, 5:initiator, 6:tokenId, 7:endTime, 8:active

function updateAuctionTableRowHTML(a) {
	text = "";
	for ( var i = 0; i < Object.keys(a).length; i++ ) {
		if ( i == 8 ) // formatting for auction end time only
			text += "<td style='word-wrap:break-word;max-width:100px'>";
		else
			text += "<td>";
		if ( (i >= 4) && (i <= 6) ) // 4:winner, 5:initiator, 6:id
			text += short_hash(a[i]) + "&nbsp;" + copy_link(a[i]);
		else if ( i == 3 ) { // highest bid
			if ( parseInt(a[i]) == 0 )
				text += "0";
			else if ( parseInt(a[i]) < 1e7 )
				text += numberWithCommas(parseInt(a[i])) + " wei";
			else if ( parseInt(a[i]) < 1e15 )
				text += numberWithCommas(parseInt(a[i])/1e9) + " gwei";
			else
				text += numberWithCommas(parseInt(a[i])/1e18) + " eth";
		} else if ( i == 7 ) { // end time
			if ( parseInt(a[i]) < 7*24*60*60 ) { // 1 week
				if ( parseInt(a[i]) == 0 )
					text += "Auction has ended";
				else
					text += "Ends " + getHMSstring(parseInt(a[i])) + "<br>after first bid";
			} else if ( Date.now()/1000 > parseInt(a[i]) )
				text += "Auction has ended";
			else if ( parseInt(a[i]) < 1000000000 )
				text += (a[i]/(24*60*60)).toFixed(2) + " days (" + numberWithCommas(a[i]) + " seconds) once started";
			else {
				text += convertTimestamp(a[i]);
				var timeleftd = -(Date.now()/1000 - a[i])/(24*60*60);
				var timelefth = -(Date.now()/1000 - a[i])/(60*60);
				var timeleftm = -(Date.now()/1000 - a[i])/(60);
				if ( timeleftd >= 1 )
					text += "<br>(" + timeleftd.toFixed(1) + " days)";
				else if ( timelefth >= 1 )
					text += "<br>(" + timelefth.toFixed(1) + " hours)";
				else
					text += "<br>(" + numberWithCommas(timeleftm.toFixed(1)) + " minutes)";
			}
		} else // 0:id, 1:num_bids, 2:data, 3:highestBid, 
			text += a[i];
		text += "</td>";
	}
	text += "<td id='nft_"+a[0]+"'>...</td>";
	document.getElementById("auction_"+a[0]).innerHTML = text;
	// get the NFT info now that the table has been updated
	if ( a[7] != "0x0000000000000000000000000000000000000000" ) {
		getNFTdata(a[0],a[6]).then(l => {
			if ( document.getElementById("nft_" + l[0]) != null )
				document.getElementById("nft_" + l[0]).innerHTML = "<a target='_blank' href='" + l[1].replace(/[^\x20-\x7E]/g, "") + "'><img style='max-width:80px;max-height:100px' src='" + l[1].replace(/[^\x20-\x7E]/g, "") + "'></a>";
		});
	}
}

// Given the table row number, it will request the data from the contract and
// write an updated table row
const updateAuctionTableRow = async(i) => {
	getAuctionInfo(i).then(l => { updateAuctionTableRowHTML(l); });
}

function handleSubscription() {
	// subscribe to updates on this contract
	var options = { address: web3.utils.toChecksumAddress('0xdbeb0000014661c033350fb04ee88d4b55ca7a4a') };
	var sub = web3.eth.subscribe('logs', options, function(err,event) {
		if ( !err )
			console.log("event error: "+event);
	});
	// pay attention to these subscription events:
	sub.on('data', event => { console.log(event); updateTable(); })
	sub.on('error', err => { throw err })
}

// writes the rows for the entire table -- this has to be called when the
// script loads, and whenever a new auction is created
function updateTable() {
	// The "main" part of this script -- once we know how many auctions there are.
	getNumAuctions().then(val => {
		// set that value in the "Total number of auctions:"  paragraph
		document.getElementById("numAuctions").innerHTML = val;
		// create the table body to list the votes and auctions
		// Auction struct fields (in order): 0:id, 1:num_bids, 2:data, 3:highestBid, 4:winner, 5:initiator, 6:tokenId, 7:endTime, 8:active
		text = "<tr><th>Auction<br>ID</th><th>Number<br>of bids</th><th>Data string</th><th>Reserve or<br>highest bid so far</th><th>Highest<br>bidder</th><th>Initiator</th><th>NFT token ID</th><th>Auction end time</th><th>Active?</th><th>NFT link / image</th></tr>";
		// for each of the auctions, create a separate table row with unique IDs
		for ( var i = 0; i < val; i++ )
			text += "<tr id='auction_" + i + "'><td colspan='10'>loading...</td></tr>";
		// write the table to the HTML page; this must happen BEFORE we start filling in the votes and auctions
		document.getElementById("auction_list").innerHTML = text;
		// call the async function that will fill in the number of votes and auctions into the table
		for ( var i = 0; i < val; i++ )
			updateAuctionTableRow(i);
	});
}

updateTable();
handleSubscription();

		</script>

		<h4>Mint NFT</h4>
		<script>
  			const mintNFT = async() => {
    			try {
      				const eth_coinbase = web3mm.utils.toChecksumAddress(await web3mm.eth.getCoinbase());
      				var str = document.getElementById('nftstring').value;
      				const txninfo = await nftContractmm.methods.mintWithURI(str).send({from:eth_coinbase, gas:1000000, gasPrice:1000000000});
      				showReturnIntegerValue(web3mm,txninfo['transactionHash'],"NFT ID");
    			} catch (error) {
      				console.error("Error: "+error);
    			}
  			}
		</script>
		<form onsubmit='return false;'>
  			<p>NFT URI / string: <input type='text' id='nftstring' style="width:200px">
  			<input type='button' value="mint" onClick="mintNFT();"></p>
		</form>
		<h4>Approve NFT Transfer</h4>
		<script>
			const approveNFT = async () => {
				try {
					const eth_coinbase = web3mm.utils.toChecksumAddress(await web3mm.eth.getCoinbase());
					var toAddress = document.getElementById('approveAddress').value;
					var tokenId = document.getElementById('tokenId').value;
					const txninfo = await nftContractmm.methods.approve(toAddress, tokenId).send({from:eth_coinbase, gas:1000000, gasPrice:1000000000});
					alert("Approval successful. Transaction hash: "+txninfo['transactionHash']);
				} catch (error) {
					console.error("Error in approving NFT transfer: " + error);
					alert("Error: " + error.message);
				}
			}
		</script>
		<form onsubmit="return false;">
			<p>Address to approve: <input type="text" id="approveAddress" style="width:200px"></p>
			<p>Token ID to approve: <input type="text" id="tokenId" style="width:200px"></p>
			<input type="button" value="approve" onClick="approveNFT();">
		</form>
		<h4>Start Auction</h4>
		<script>
			const startAuction = async () => {
        		try {
            		const eth_coinbase = web3mm.utils.toChecksumAddress(await web3mm.eth.getCoinbase());
            		const minutes = document.getElementById('auctionMinutes').value;
            		const hours = document.getElementById('auctionHours').value;
            		const days = document.getElementById('auctionDays').value;
            		const description = document.getElementById('auctionDescription').value;
            		const reserve = document.getElementById('auctionReserve').value;
            		const nftId = document.getElementById('auctionNftId').value;
            
            		if(!description || (minutes == 0 && hours == 0 && days == 0)) {
                		alert('Invalid input for the auction.');
                	return;
            		}
            
            		const txninfo = await auctionContractmm.methods.startAuction(
                	minutes, hours, days, description, reserve, nftId
            		).send({from: eth_coinbase, gas: 1000000, gasPrice: 1000000000});
            
            		alert("Auction started successfully. Transaction hash: " + txninfo.transactionHash);
        		} catch (error) {
            		console.error("Error in starting auction: " + error);
            		alert("Error: " + error.message);
        		}
    		}
		</script>
		<form onsubmit="return false;">
			<p>Minutes: <input type="text" id="auctionMinutes" style="width:100px"></p>
			<p>Hours: <input type="text" id="auctionHours" style="width:100px"></p>
			<p>Days: <input type="text" id="auctionDays" style="width:100px"></p>
			<p>Description: <input type="text" id="auctionDescription" style="width:200px"></p>
			<p>Reserve Price (in wei): <input type="text" id="auctionReserve" style="width:200px"></p>
			<p>NFT ID: <input type="text" id="auctionNftId" style="width:200px"></p>
			<input type="button" value="Start Auction" onClick="startAuction();">
		</form>
		<h4>Place Bid</h4>
		<script>
			const placeBid = async () => {
				try {
					const eth_coinbase = web3mm.utils.toChecksumAddress(await web3mm.eth.getCoinbase());
					const auctionId = document.getElementById('bidAuctionId').value;
					const bidAmount = document.getElementById('bidAmount').value;
		
					if (!auctionId || !bidAmount || isNaN(bidAmount)) {
						alert('Please enter valid auction ID and bid amount.');
						return;
					}
		
					const txninfo = await auctionContractmm.methods.placeBid(auctionId).send({
						from: eth_coinbase,
						value: bidAmount, 
						gas: 1000000, 
						gasPrice: 1000000000 
					});
		
					alert("Bid placed successfully. Transaction hash: " + txninfo.transactionHash);
				} catch (error) {
					console.error("Error in placing bid: " + error);
					alert("Error: " + error.message);
				}
			}
		</script>
		<form onsubmit="return false;">
			<p>Auction ID: <input type="text" id="bidAuctionId" style="width:200px"></p>
			<p>Bid Amount (in wei): <input type="text" id="bidAmount" style="width:200px"></p>
			<input type="button" value="Place Bid" onClick="placeBid();">
		</form>
		<h4>Close Auction</h4>
		<script>
    		const closeAuction = async () => {
    			try {
            		const eth_coinbase = web3mm.utils.toChecksumAddress(await web3mm.eth.getCoinbase());
            		const auctionId = document.getElementById('closeAuctionId').value;

            		if (!auctionId) {
               	 		alert('Please enter a valid auction ID.');
                		return;
            		}

            		const txninfo = await auctionContractmm.methods.closeAuction(auctionId).send({
                		from: eth_coinbase, 
                		gas: 1000000, 
                		gasPrice: 1000000000
            		});

            		alert("Auction closed successfully. Transaction hash: " + txninfo.transactionHash);
        		} catch (error) {
            		console.error("Error in closing auction: " + error);
            		alert("Error: " + error.message);
        		}
    		}
		</script>
		<form onsubmit="return false;">
    		<p>Auction ID: <input type="text" id="closeAuctionId" style="width:200px"></p>
   			 <input type="button" value="Close Auction" onClick="closeAuction();">
		</form>
		<p>IAuctioneer ABI: <script></script><span class="copylink" onclick="navigator.clipboard.writeText(&#39;[{\&#39;anonymous\&#39;:false,\&#39;inputs\&#39;:[{\&#39;indexed\&#39;:true,\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;auctionCloseEvent\&#39;,\&#39;type\&#39;:\&#39;event\&#39;,\&#39;signature\&#39;:\&#39;0x764a9bf85f9c4798cc097d029385833abb4b696719a76deb10c8a41e0f6c08c8\&#39;},{\&#39;anonymous\&#39;:false,\&#39;inputs\&#39;:[{\&#39;indexed\&#39;:true,\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;auctionStartEvent\&#39;,\&#39;type\&#39;:\&#39;event\&#39;,\&#39;signature\&#39;:\&#39;0x8811bfc51ca0c310b80b2d763b1b3b59c4596b1d41abcffe2b111ebfe3b611f4\&#39;},{\&#39;anonymous\&#39;:false,\&#39;inputs\&#39;:[{\&#39;indexed\&#39;:true,\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;higherBidEvent\&#39;,\&#39;type\&#39;:\&#39;event\&#39;,\&#39;signature\&#39;:\&#39;0xce4f98a5b6af3ef74aec248a469ccbce8863e02d078b97fc2f047aac2db05fbb\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;auctionTimeLeft\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0xd798b8da\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;auctions\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;string\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;string\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;address\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;address\&#39;},{\&#39;internalType\&#39;:\&#39;address\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;address\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;bool\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;bool\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0x571a26a0\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;closeAuction\&#39;,\&#39;outputs\&#39;:[],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;signature\&#39;:\&#39;0x236ed8f3\&#39;},{\&#39;inputs\&#39;:[],\&#39;name\&#39;:\&#39;collectFees\&#39;,\&#39;outputs\&#39;:[],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;signature\&#39;:\&#39;0xc8796572\&#39;},{\&#39;inputs\&#39;:[],\&#39;name\&#39;:\&#39;deployer\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;address\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;address\&#39;}],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;signature\&#39;:\&#39;0xd5f39488\&#39;},{\&#39;inputs\&#39;:[],\&#39;name\&#39;:\&#39;nftmanager\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;address\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;address\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0xeb38603f\&#39;},{\&#39;inputs\&#39;:[],\&#39;name\&#39;:\&#39;numAuctions\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0x5c113acc\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;id\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;placeBid\&#39;,\&#39;outputs\&#39;:[],\&#39;stateMutability\&#39;:\&#39;payable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;payable\&#39;:true,\&#39;signature\&#39;:\&#39;0x9979ef45\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;m\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;h\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;d\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;string\&#39;,\&#39;name\&#39;:\&#39;data\&#39;,\&#39;type\&#39;:\&#39;string\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;reserve\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;nftid\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;startAuction\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;signature\&#39;:\&#39;0x06090211\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;bytes4\&#39;,\&#39;name\&#39;:\&#39;interfaceId\&#39;,\&#39;type\&#39;:\&#39;bytes4\&#39;}],\&#39;name\&#39;:\&#39;supportsInterface\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;bool\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;bool\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0x01ffc9a7\&#39;},{\&#39;inputs\&#39;:[],\&#39;name\&#39;:\&#39;totalFees\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0x13114a9d\&#39;},{\&#39;inputs\&#39;:[],\&#39;name\&#39;:\&#39;uncollectedFees\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;,\&#39;constant\&#39;:true,\&#39;signature\&#39;:\&#39;0x463ccc74\&#39;}]&#39;)">⎘</span>; NFT manager reduced ABI: <script></script><span class="copylink" onclick="navigator.clipboard.writeText(&#39;[{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;address\&#39;,\&#39;name\&#39;:\&#39;to\&#39;,\&#39;type\&#39;:\&#39;address\&#39;},{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;tokenId\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;approve\&#39;,\&#39;outputs\&#39;:[],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;address\&#39;,\&#39;name\&#39;:\&#39;_to\&#39;,\&#39;type\&#39;:\&#39;address\&#39;},{\&#39;internalType\&#39;:\&#39;string\&#39;,\&#39;name\&#39;:\&#39;_uri\&#39;,\&#39;type\&#39;:\&#39;string\&#39;}],\&#39;name\&#39;:\&#39;mintWithURI\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;string\&#39;,\&#39;name\&#39;:\&#39;_uri\&#39;,\&#39;type\&#39;:\&#39;string\&#39;}],\&#39;name\&#39;:\&#39;mintWithURI\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;stateMutability\&#39;:\&#39;nonpayable\&#39;,\&#39;type\&#39;:\&#39;function\&#39;},{\&#39;inputs\&#39;:[{\&#39;internalType\&#39;:\&#39;uint256\&#39;,\&#39;name\&#39;:\&#39;tokenId\&#39;,\&#39;type\&#39;:\&#39;uint256\&#39;}],\&#39;name\&#39;:\&#39;tokenURI\&#39;,\&#39;outputs\&#39;:[{\&#39;internalType\&#39;:\&#39;string\&#39;,\&#39;name\&#39;:\&#39;\&#39;,\&#39;type\&#39;:\&#39;string\&#39;}],\&#39;stateMutability\&#39;:\&#39;view\&#39;,\&#39;type\&#39;:\&#39;function\&#39;}]&#39;)">⎘</span></p>
	
</body></html>
